<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<title>slide example</title>
<style>
html, body {
    height: 100%;
    width: 100%;
    margin: 0;
    padding: 0;
    overflow:hidden;
    background-color: #000;
}
ul, li {
    margin: 0;
    padding: 0;
    list-style-type: none;
}
#wrapper {
    width: 100%;
    height:100%;
    overflow:hidden;
    background-color: #000;
    position: relative;
}
.slide {
    height:100%;
}
.panel {
    position: relative;    
}

.btn {
	position: absolute;
    top: 45%;
	width: 58px;
	height: 58px;
	overflow: hidden;
	background-color: black;
	z-index: 2000;
	cursor: pointer;
	border: 1px solid #464646;
	text-align: center;
	opacity: 0.6; 
}
#prev-button {
    left: 10px;
}
#next-button{
    right: 10px;
}
.btn .ico {
	width: 16px;
	height: 30px;
	overflow: hidden;
	margin: 16px auto 0 auto;
	background: url(http://i1.daumcdn.net/img-section/enter/common/pv_icon1.png) 0 -30px no-repeat;
}
#next-button .ico {
	background-position: 0 -60px;
	width: 13px;
	margin-left: 24px;
}

#footer {
    width: 100%;
    z-index: 999;
    position: absolute;
    bottom:0;
}

</style>
<script type="text/javascript" src="http://east.ftdev.daum.net/g/js/gesture.js"></script>
<script type="text/javascript" src="js/slide.js"></script>

</head>
<body>
<div id="wrapper"></div>
<div id="header"></div>
<div id="prev-button" class="btn"><div class="ico"></div></div>
<div id="next-button" class="btn"><div class="ico"></div></div>
<div id="footer"></div>
<script type="text/javascript">

var d = (function(){
    var d = slideDataSource.listener(false, 5);
    var s = null;
    var pageNum = (function (){
        var pagenum = 1;
        return function(){
            return pagenum++;
        };
    })();
    
    var headTag = document.getElementsByTagName("head")[0];
    var wrapper = document.getElementById("wrapper");
    d.onRequestData(function(){
        var callbackName = "d.responseData";
        var url = 'http://media.daum.net/export/json/3165a129029c43ea8078217ae6ed99a2?photoId=2797&newsId=20120321155308240&page='+ pageNum()+'&countPerPage=100&callback='+ callbackName;
        var s = document.createElement("script");
        s.type = "text/javascript";
        s.src = url;
        s.charset = "utf-8";
        headTag.appendChild(s);
    });
    d.onParseData(function(jsonStr){
    	console.log(jsonStr);
        var list = jsonStr.list;
        var data = list.data;
        var arr = [];
        for (var i=0, len=data.length; i< len; i++) {
            arr.push( data[i] );
        }
                
        headTag.removeChild(headTag.lastChild);
        d.setDataTotalLength(parseInt(list.pageNavigation.totalRowCount));
        
        return arr;
    });
    d.onDataLoadEnd(function(){
        if (s === null) {
            s = slide.slideListener(wrapper, d, 0);
            s.setSlideTreshold(0.1);
            var click = "ontouchstart" in window ? "touchstart" : "click";
            var prevBtn = document.getElementById("prev-button");
            var nextBtn = document.getElementById("next-button");
            prevBtn.addEventListener(click, function(){
                s.prevSlide('500ms');
            }, false);
            nextBtn.addEventListener(click, function(){
                s.nextSlide('500ms');
            }, false);
            
            var clientHeight = wrapper.clientHeight-10;
            var clientWidth = wrapper.clientWidth-10;
            s.onResize(function(){
                clientHeight = wrapper.clientHeight-10;
                clientWidth = wrapper.clientWidth-10;

                var imgs = document.getElementsByTagName("img");
                var imgSize = {};
                var imgOffset = {};
                for(var k=0, len = imgs.length; k<len; k++) {
                    imgSize = resizeImg(imgs[k].getAttribute("data-width"), imgs[k].getAttribute("data-height"));
                    imgOffset = getImgOffset(imgSize.width, imgSize.height);
                    imgs[k].width = imgSize.width;
                    imgs[k].height = imgSize.height;
                    imgs[k].style.position = 'absolute';
                    imgs[k].style.left = ''+imgOffset.left+'px';
                    imgs[k].style.top = ''+imgOffset.top+'px';
                }
            });
            function resizeImg(width, height) {
                var imgSize = {};
                if (clientHeight > clientWidth) {
                    if (clientWidth * height > clientHeight * width) {
                        imgSize.height = clientHeight;
                        imgSize.width = parseInt(clientHeight * width / height);
                    } else {
                        imgSize.width = clientWidth;
                        imgSize.height = parseInt(clientWidth * height / width);
                    }
                } else {
                    if (clientWidth * height < clientHeight * width) {
                        imgSize.width = clientWidth;
                        imgSize.height = parseInt(clientWidth * height / width);
                    } else {
                        imgSize.height = clientHeight;
                        imgSize.width = parseInt(clientHeight * width / height);
                    }
                }
                return imgSize;
            }
            function getImgOffset(width, height) {
                var imgOffset = {};
                imgOffset.left = parseInt((clientWidth+10-width)/2);
                imgOffset.top = parseInt((clientHeight+10-height)/2);
                return imgOffset;
            }
            s.onSetDataItem(function(item){
                if (item && item.type !== '') {
                    var imgSize = resizeImg(item.width, item.height);
                    var imgOffset = getImgOffset(imgSize.width, imgSize.height);
                    var str = '<img alt="'+item.title+'" src="'+item.image+'" width="'+imgSize.width+'" height="'+imgSize.height+'" data-width="'+item.width+'" data-height="'+item.height+'"style=position:absolute;top:'+imgOffset.top+'px;left:'+imgOffset.left+'px;">';
                    return str;
                } else {
                    return '';
                }
            });
            s.setInitData(0);
            s.onSlideStart(function(session){
                session.targetEvent.preventDefault();
            });
            function replaceAll(txt, replace, with_this) {
                return txt.replace(new RegExp(replace, 'g'),with_this);
            }
            function changeText(text) {
                text = replaceAll(text, "&lt;", "<");
                text = replaceAll(text, "&gt;", ">");
                text = replaceAll(text, "&nbsp; "," ");
                text = replaceAll(text, "&amp;", "&");
                text = replaceAll(text, "&quot;", "\"");
                
                return text;
            }
            function changeLinkText(link) {
                if (link.length > 37) {
                    return link.substring(0,35) + ".."
                } else {
                    return link;
                }
            }
            var footer = document.getElementById("footer");
            function setCurrentDesc() {
                var item = d.getCurrentData();
                if (item) {
                    var data = item.data;
                    var title = changeText(data.title);
                    var linktext = changeLinkText(data.link);
                    var str = '<div class="wrap_desc" style="opacity: 0.7;" id="desc_field">' +
                                '<a href="'+data.link+'" class="tit" id="desc_title">'+ title +'</a>' +
                                '<span class="info" id="desc_info">'+data.width+' x '+data.height+'</span><a href="'+data.link+'" id="desc_url" class="link_src">'+ linktext +'</a>' +
                                '<div class="wrap_btn">' +
                                    '<a href="" class="left_wrap"><span class="prev">검색결과로 돌아가기</span></a>' + 
                                    '<a id="desc_link" href="'+data.image+'" target="_blank" class="right_wrap"><span class="bar"></span><span>원본 바로보기</span></a>' +
                                '</div></div>';
                } else {
                    var str = '';
                }
                footer.innerHTML = str;
            }
            setCurrentDesc();
            var viewState = "block";
            s.onSlideEnd(function(session){
                if (!session.isSwipe() && !session.isScroll()) {
                    if (viewState === "none") {
                        footer.style.display = "block";
                        prevBtn.style.display = "block";
                        nextBtn.style.display = "block";
                        viewState = "block";
                    } else {
                        footer.style.display = "none";
                        prevBtn.style.display = "none";
                        nextBtn.style.display = "none";
                        viewState = "none";
                    }
                }
            });
            s.onSlideNext(function(){setCurrentDesc();});
            s.onSlidePrev(function(){setCurrentDesc();});
        }
    });
    
     
    window.addEventListener("load", function(e){  
        d.sendRequestData();
    });
    
    return d;
})();
</script>

</body>
</html>