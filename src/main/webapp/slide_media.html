<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<title>slide example</title>
<style>
html, body {
    height: 100%;
    width: 100%;
    margin: 0;
    padding: 0;
    overflow:hidden;
    background-color: #333;
}
ul, li {
    margin: 0;
    padding: 0;
    list-style-type: none;
}
#wrapper {
    width: 100%;
    height:100%;
    overflow:hidden;
    background-color: #333;
    position: relative;
}
.slide {
    height:100%;
}
.panel {
    position: relative;    
    background: url(http://m1.daumcdn.net/img-section/enter/common/loading.gif) 50% 50% no-repeat;
}
.btn {
    position: absolute;
    top: 45%;
    width: 58px;
    height: 58px;
    overflow: hidden;
    background-color: black;
    z-index: 2000;
    cursor: pointer;
    border: 1px solid #464646;
    text-align: center;
    opacity: 0.6; 
}
#prev-button {
    left: 10px;
}
#next-button{
    right: 10px;
}
.btn .ico {
    width: 16px;
    height: 30px;
    overflow: hidden;
    margin: 16px auto 0 auto;
    background: url(http://i1.daumcdn.net/img-section/enter/common/pv_icon1.png) 0 -30px no-repeat;
}
#next-button .ico {
    background-position: 0 -60px;
    width: 13px;
    margin-left: 24px;
}

#header {
    width: 100%;
    z-index: 999;
    position: absolute;
    top:0;
}

#footer {
    width: 100%;
    z-index: 999;
    position: absolute;
    bottom:0;
}

#title-wrap {
    position: absolute;
    bottom: 0;
    left: 0;
    z-index: 9999;
    width: 100%;
    display: none;
    background-color: black;
    color: white;
    text-align: center;
    letter-spacing: -1px;
}
#title-wrap .inner {
    margin: 13px;
}
#title-wrap .title {
    font: bold 16px dotum;
    color: white;
    text-decoration: none;
}
#title-wrap .bar {
    padding: 0 9px;
    font-size: 14px;
    color: #2E2F2A;
    position: relative;
    top: -2px;
}
#title-wrap .link {
    color: #9AF;
    font-size: 12px;
    position: relative;
    top: -2px;
}
#title-wrap .ico {
    padding: 0 0 0 3px;
}
#title-wrap .ico span {
    position: relative;
    top: 7px;
    padding: 0 0 0 5px;
    background: url(http://i1.daumcdn.net/img-section/enter/common/pv_icon1.png) 0 -90px no-repeat;
    overflow: hidden;
}

div.ps-caption {
    background: black;
    color: #9AF;
    font: bold 14px dotum;
    text-align: center;
    width: 100%!important;
    z-index: 9999!important;
}
.ps-caption-content {
    padding: 13px;
    display: block;
}
.ps-caption-content .count {
    color: white;
    font-size: 12px;
    font-weight: normal;
    padding-left: 3px;
}
.ps-caption-content .count em {
    color: #9AF;
    font-style: normal;
    font-size: 12px;
}
#close-button {
    position: absolute;
    top: 0;
    right: 0;
    height: 100%;
    width: 70px;
    border-left: 1px solid #2F2F2F;
    cursor: pointer;
    text-align: center;
    background-color: black;
}
#close-button .ico {
    width: 25px;
    height: 23px;
    overflow: hidden;
    margin: 10px auto 0 auto;
    background: url(http://i1.daumcdn.net/img-section/enter/common/pv_icon1.png) 0 0 no-repeat;
}
</style>
<script type="text/javascript" src="http://east.ftdev.daum.net/g/js/gesture.js"></script>
<script type="text/javascript" src="js/slide.js"></script>

</head>
<body>
<div id="wrapper"></div>
<div id="header">
    <div class="ps-caption" style="left: 0px; position: absolute; overflow-x: hidden; overflow-y: hidden; z-index: 1000; top: 0px; width: 1078px; opacity: 0.8; display: block; ">
        <div class="ps-caption-content"><span class="ps-title"></span><span class="count"></span></div>
        <div id="close-button"><div class="ico"></div></div>
    </div>
</div>
<div id="prev-button" class="btn"><div class="ico"></div></div>
<div id="next-button" class="btn"><div class="ico"></div></div>
<div id="footer"></div>
<script type="text/javascript">
var d = (function(){
    var pageInfo = {
        currentPage: 3, 
        currentIndex: 31,
        numPerPage: 32,
        nextPage: 3,
        getNextPage: function () {
            return this.nextPage++;
        },
        prevPage: 2,
        getPrevPage: function (){
            return this.prevPage--;
        }
    };
    var d = slideDataSource.listener(false, 5, 5);
    var headTag = document.getElementsByTagName("head")[0];
    var wrapper = document.getElementById("wrapper");
    function requestData(page, callbackName) {
         var url = 'http://media.daum.net/export/json/3165a129029c43ea8078217ae6ed99a2?photoId=2797&newsId=&page='+ page +'&countPerPage=100&callback='+ callbackName;
         var script = document.createElement("script");
         script.type = "text/javascript";
         script.src = url;
         script.charset = "utf-8";
         headTag.appendChild(script);
    }
    d.onRequestData(function(){
        requestData(pageInfo.getNextPage(), "d.responseData");
    });
    d.onRequestPrevData(function(){
        var page = pageInfo.getPrevPage();
        if (page > 0) {
            pageInfo.currentPage = page;
            pageInfo.currentIndex += pageInfo.numPerPage;
            requestData(page, "d.responsePrevData");
        }
    });
    var header = document.getElementById("header");
    var psTitle = header.getElementsByClassName("ps-title")[0];
    var psCount = header.getElementsByClassName("count")[0];
    d.onParseData(function(jsonStr){
        var list = jsonStr.list;
        var data = list.data;
        var totalcount = parseInt(jsonStr.count);
        var arr = [];
        for (var i=0, len=data.length; i< len; i++) {
            arr.push( data[i] );
        }
                
        headTag.removeChild(headTag.lastChild);
        d.setDataTotalLength(totalcount);
        
        psTitle.innerHTML = jsonStr.title;
        return arr;
    });
    
    function setInitSlide () {
        var s = slide.slideListener(wrapper, d, 0);
        s.setSlideTreshold(0.1);
        var click = "ontouchstart" in window ? "touchstart" : "click";
        var prevBtn = document.getElementById("prev-button");
        var nextBtn = document.getElementById("next-button");
        var closeBtn = document.getElementById("close-button");
        prevBtn.addEventListener(click, function(){
            s.prevSlide('500ms');
        }, false);
        nextBtn.addEventListener(click, function(){
            s.nextSlide('500ms');
        }, false);
        closeBtn.addEventListener(click, function() {
            window.history.back();
        }, false);
        
        var clientHeight = wrapper.clientHeight-10;
        var clientWidth = wrapper.clientWidth-10;
        s.onResize(function(){
            clientHeight = wrapper.clientHeight-10;
            clientWidth = wrapper.clientWidth-10;

            var imgs = document.getElementsByTagName("img");
            var imgSize = {};
            var imgOffset = {};
            for(var k=0, len = imgs.length; k<len; k++) {
                imgSize = resizeImg(imgs[k].naturalWidth, imgs[k].naturalHeight);
                imgOffset = getImgOffset(imgSize.width, imgSize.height);
                
                imgs[k].style.cssText = 'width:'+imgSize.width+'px;height:'+imgSize.height+'px;top:'+imgOffset.top+'px;left:'+imgOffset.left+'px;position:absolute;';
            }
        });
        function resizeImg(width, height) {
            var imgSize = {};
            if (clientHeight > clientWidth) {
                if (clientWidth * height > clientHeight * width) {
                    imgSize.height = clientHeight;
                    imgSize.width = parseInt(clientHeight * width / height);
                } else {
                    imgSize.width = clientWidth;
                    imgSize.height = parseInt(clientWidth * height / width);
                }
            } else {
                if (clientWidth * height < clientHeight * width) {
                    imgSize.width = clientWidth;
                    imgSize.height = parseInt(clientWidth * height / width);
                } else {
                    imgSize.height = clientHeight;
                    imgSize.width = parseInt(clientHeight * width / height);
                }
            }
            return imgSize;
        }
        function getImgOffset(width, height) {
            var imgOffset = {};
            imgOffset.left = parseInt((clientWidth+10-width)/2);
            imgOffset.top = parseInt((clientHeight+10-height)/2);
            return imgOffset;
        }
        
        d.onImgLoad = function (el) {
            var imgSize = resizeImg(el.naturalWidth, el.naturalHeight);
            var imgOffset = getImgOffset(imgSize.width, imgSize.height);
            
            el.style.cssText = 'width:'+imgSize.width+'px;height:'+imgSize.height+'px;top:'+imgOffset.top+'px;left:'+imgOffset.left+'px;position:absolute;';
        };
        d.onImgLoadError = function (el) {
            el.parentNode.style.background = "none";
        };
        s.onSetDataItem(function(item){
            if (item && item.type !== '') {
                var cdnImgUrl = item.image.replace("http://photo-media.daum-img.net","http://m1.daumcdn.net/photo-media");
                var str = '<img alt="'+escape(item.title)+'" src="'+cdnImgUrl+'" style="position:absolute;width:1px;height:1px;" onload="d.onImgLoad(this);" onerror="d.onImgLoadError(this);" onabort="d.onImgLoadError(this);">';
                return str;
            } else {
                return '';
            }
        });
       
        s.onSlideStart(function(session){
            session.targetEvent.preventDefault();
        });
        var footer = document.getElementById("footer");
        function setCurrentDesc() {
            var item = d.getCurrentData();
            if (item) {
                var data = item.data;
                var footerStr = '<div id="title-wrap" style="opacity: 0.8; display: block;">'
                                + '<div class="inner">'
                                        + '<a href="http://newslink.media.daum.net/mobile/'+data.id+'" class="title">'+data.title+'</a>'
                                        + '<span class="bar">|</span>'
                                        + '<a href="http://newslink.media.daum.net/mobile/'+data.id+'" class="link">기사보기</a>'
                                        + '<span class="ico"><span></span></span>'
                                + '</div>'
                              + '</div>';
            } else {
                var footerStr = '';
            }
            psCount.innerHTML = '(<em>'+(((pageInfo.currentPage-1)*pageInfo.numPerPage)+d.getCurrentIndex()+1)+'</em>/'+d.getDataTotalLength()+')';
            footer.innerHTML = footerStr;
        }
        setCurrentDesc();
        var viewState = "block";
        s.onSlideEnd(function(session){
            if (!session.isSwipe() && !session.isScroll()) {
                if (viewState === "none") {
                    header.style.display = "block";
                    footer.style.display = "block";
                    prevBtn.style.display = "block";
                    nextBtn.style.display = "block";
                    viewState = "block";
                } else {
                    header.style.display = "none";
                    footer.style.display = "none";
                    prevBtn.style.display = "none";
                    nextBtn.style.display = "none";
                    viewState = "none";
                }
            }
        });
        s.onSlideNext(function(){setCurrentDesc();});
        s.onSlidePrev(function(){setCurrentDesc();});
        console.log(pageInfo.currentIndex);
        s.setInitData(pageInfo.currentIndex);
    }
    window.addEventListener("load", function(e){  
        d.setInitData(pageInfo.currentIndex, setInitSlide);
    });
    
    return d;
})();
</script>

</body>
</html>